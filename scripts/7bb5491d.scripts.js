"use strict";angular.module("zupWebAngularApp",["ngCookies","ngResource","ngSanitize","ngRoute","ui.bootstrap"]).config(["$routeProvider","$httpProvider",function(a,b){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/reports",{templateUrl:"views/reports.html",controller:"ReportsCtrl"}).when("/account",{templateUrl:"views/account.html",controller:"AccountCtrl"}).otherwise({redirectTo:"/"}),b.interceptors.push(["$q","$injector",function(a,b){return{request:function(c){c.url=c.url.replace("{base_url}","http://staging.zup.sapience.io");var d=null;return b.invoke(["Auth",function(a){d=a.getToken()}]),c.headers["X-App-Token"]=d,c||a.when(c)},responseError:function(c){var d=c.config.expectedErrors;return("undefined"==typeof d||-1===d.indexOf(c.status))&&b.invoke(["Error",function(a){a.showDetails(c)}]),a.reject(c)}}}]),b.defaults.useXDomain=!0,delete b.defaults.headers.common["X-Requested-With"]}]).run(["$rootScope","$q","$location","Auth","$modal","Reports",function(a,b,c,d,e,f){a.$on("$routeChangeStart",function(c,e,g){"undefined"==typeof g&&(a.isLoading=!0),"MainCtrl"===e.controller?a.page="main":"ReportsCtrl"===e.controller?a.page="reports":"AccountCtrl"===e.controller&&(a.page="account");var h=d.check();a.markers={reports:{},items:{}},a.categories={};var i=f.get(function(b){a.categories=b.categories});b.all([i.$promise,h.$promise]).then(function(){for(var b=a.categories.length-1;b>=0;b--)a.markers.reports[a.categories[b].id]=[];a.isLoading=!1}),h.then(function(){a.logged=!0},function(){a.logged=!1})}),a.getReportCategory=function(b){for(var c=a.categories.length-1;c>=0;c--)if(a.categories[c].id===b)return a.categories[c];return null},a.filterByReportCategory=function(b){for(var c in a.markers.reports)if(c==b.id)for(var d=a.markers.reports[c].length-1;d>=0;d--)a.markers.reports[c][d].setVisible(a.markers.reports[c][d].getVisible()===!0?!1:!0)},a.login=function(){e.open({templateUrl:"views/modal_login.html",windowClass:"modal_login",controller:["$scope","$rootScope","$modalInstance","User",function(a,b,c,d){a.inputs={},a.close=function(){c.close()},a.signup=function(){c.close(),b.signup()},a.login=function(){a.loginError=!1;var e=new d(a.inputs.email,a.inputs.password);e.auth().then(function(){b.logged=!0,c.close()},function(b){(400===b.status||401===b.status)&&(a.loginError=!0)})}}]})},a.signup=function(){e.open({templateUrl:"views/modal_signup.html",windowClass:"modal_signup",controller:["$scope","$modalInstance","Users","Alert",function(a,b,c,d){a.inputs={},a.close=function(){b.close()},a.register=function(){a.inputErrors={},a.processingForm=!0;var e=new c(a.inputs);e.$save(function(){b.close(),d.show("Parabéns!","Sua conta foi criada com sucesso. Agora você pode efetuar solicitações de limpeza de boca de lobo e para coletas de entulho.")},function(b){a.processingForm=!1,a.inputErrors=b.data.error})}}]})},a.newReport=function(){e.open({templateUrl:"views/modal_new_report.html",windowClass:"modal_new_report",controller:["$scope","$modalInstance","Reports","Alert",function(a,b,c,d){a.inputs={description:null},a.categoryData=null,a.lat=null,a.lng=null,a.formattedAddress=null,a.policy=!1,a.close=function(){b.close()},a.selectCategory=function(b){a.categoryData=b},a.send=function(){a.inputErrors={},a.processingForm=!0;var e=new c({categoryId:a.categoryData.id,latitude:a.lat,longitude:a.lng,description:a.inputs.description,address:a.formattedAddress});e.$save(function(){b.close(),d.show("Relato criado com sucesso","Agora você pode checar o status do seu relato no menu superior.")},function(b){a.processingForm=!1,a.inputErrors=b.data.error})}}]})},a.viewReport=function(a,b){e.open({templateUrl:"views/modal_view_report.html",windowClass:"modal_view_report",resolve:{report:function(){return a},category:function(){return b}},controller:["$scope","$modalInstance","report","category",function(a,b,c,d){a.report=c,a.category=d,a.close=function(){b.close()};for(var e=d.statuses.length-1;e>=0;e--)d.statuses[e].id===c.status_id&&(a.status=d.statuses[e])}]})},a.logout=function(){d.clearToken(),d.saveUser(null),a.logged=!1}}]),angular.module("zupWebAngularApp").controller("MainCtrl",function(){}),angular.module("zupWebAngularApp").service("User",["$q","$http","Auth",function(a,b,c){return function(d,e){this.auth=function(){var f=a.defer(),g=b({method:"POST",url:"{base_url}/authenticate.json",data:{email:d,password:e},expectedErrors:[400,401]});return g.success(function(a){c.saveUser(a.user),c.saveToken(a.token),f.resolve()}),g.error(function(a,b,c,d){f.reject({data:a,status:b,config:d})}),f.promise}}}]),angular.module("zupWebAngularApp").factory("Auth",["$q","$http","$cookies","$rootScope",function(a,b,c,d){var e=null;return{check:function(){var c=a.defer(),d=this.getToken();if(null!==d&&null===e){var f=b({method:"GET",url:"{base_url}/me.json",headers:{"X-App-Token":d}}),g=this;f.success(function(a){g.saveUser(a.user),c.resolve()}),f.error(function(){c.reject(),g.clearToken()})}else null!==d&&null!==e?c.resolve():(c.reject(),this.clearToken());return c.promise},getToken:function(){var a=c.token;return"undefined"==typeof a?null:a},saveToken:function(a){c.token=a},clearToken:function(){delete c.token},saveUser:function(a){e=a,d.me=e},isLogged:function(){return null!==e&&null!==this.getToken()}}}]),angular.module("zupWebAngularApp").factory("Users",["$resource",function(a){return a("{base_url}/users/:id.json",{id:"@id"},{save:{method:"POST",expectedErrors:[400]},update:{method:"PUT"},getAll:{method:"GET"}})}]),angular.module("zupWebAngularApp").factory("Error",["$modal",function(a){return{showDetails:function(b){a.open({templateUrl:"views/modal_error.html",resolve:{response:function(){return b}},controller:["$scope","$modalInstance","response",function(a,b,c){a.response=c,a.ok=function(){window.location.reload()}}]})}}}]),angular.module("zupWebAngularApp").directive("genericInput",function(){return{restrict:"A",link:function(a,b){a.$parent.$watch("inputErrors",function(){var c=a.$parent.inputErrors,d=angular.element("label[for='"+b.attr("id")+"']");if(b.removeClass("has-error"),d.removeClass("has-error"),"undefined"!=typeof c)for(var e in c)e===b.attr("name")&&(console.log(e,c[e]),b.addClass("has-error"),d.addClass("has-error"))}),a.$parent.$watch("processingForm",function(){a.$parent.processingForm===!0?b.attr("disabled",!0):b.attr("disabled",!1)})}}}),angular.module("zupWebAngularApp").directive("mapItems",function(){return{restrict:"A",link:function(a,b){b.css({width:$(window).width()-300,height:$(window).height()});var c=[{},{featureType:"poi.business",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.government",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.medical",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.place_of_worship",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.school",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.sports_complex",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"labels",stylers:[{visibility:"off"},{saturation:-100},{lightness:42}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{saturation:-100},{lightness:47}]},{featureType:"landscape",stylers:[{lightness:82},{saturation:-100}]},{featureType:"water",stylers:[{hue:"#00b2ff"},{saturation:-21},{lightness:-4}]},{featureType:"poi",stylers:[{lightness:19},{weight:.1},{saturation:-22}]},{elementType:"geometry.fill",stylers:[{visibility:"on"},{lightness:18}]},{elementType:"labels.text",stylers:[{saturation:-100},{lightness:28}]},{featureType:"poi.attraction",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{saturation:12},{lightness:25}]},{featureType:"road",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels.text",stylers:[{lightness:30}]},{featureType:"landscape.man_made",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{saturation:-100},{lightness:56}]},{featureType:"road.local",elementType:"geometry.fill",stylers:[{lightness:62}]},{featureType:"landscape.man_made",elementType:"geometry",stylers:[{visibility:"off"}]}],d=new google.maps.StyledMapType(c,{name:"zup"}),e=new google.maps.LatLng(-23.549671,-46.6321713),f={center:e,zoom:17,disableDefaultUI:!0,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,"zup"]}},g=new google.maps.Map(b[0],f);g.mapTypes.set("zup",d),g.setMapTypeId("zup");for(var h=[[],[],[],[],[]],i=["images/4fd8c824.map_pin_boca-lobo.png","images/3bb7468f.map_pin_entulho.png","images/0ee61379.ponto_bocalobo.png","images/98cfce97.ponto_floresta-urbana.png","images/455bb34c.ponto_praca-wifi.png"],j=[[[-23.549671,-46.6321713]],[[-23.549297,-46.633701]],[[-23.552349,-46.632923],[-23.551926,-46.632601],[-23.55113,-46.632376],[-23.549861,-46.632065],[-23.54931,-46.632043],[-23.548307,-46.632494]],[[-23.549822,-46.631056],[-23.549654,-46.630638],[-23.550087,-46.630852],[-23.549969,-46.630509],[-23.549841,-46.630273],[-23.54929,-46.629908],[-23.549576,-46.629544]],[[-23.550878,-46.631134]]],k=[[['<h1>Coleta de entulho</h1><p>Enviada ontem</p><a href="#/items/1" data-toggle="modal" data-target="#item_pin1">Ver detalhes</a>']],[['<h1>Coleta de entulho</h1><p>Enviada hoje</p><a href="#/items/1" data-toggle="modal" data-target="#item_pin1">Ver detalhes</a>']],[['<h1>Coleta de entulho</h1><p>Enviada hoje</p><a href="#/items/1" data-toggle="modal" data-target="#item_pin1">Ver detalhes</a>'],['<h1>Coleta de entulho</h1><p>Enviada há 3 dias</p><a href="#/items/1" data-toggle="modal" data-target="#item_pin1">Ver detalhes</a>'],['<h1>Coleta de entulho</h1><p>Enviada há 5 dias</p><a href="#/items/1" data-toggle="modal" data-target="#item_pin1">Ver detalhes</a>'],['<h1>Coleta de entulho</h1><p>Enviada há 4 dias</p><a href="#/items/1" data-toggle="modal" data-target="#item_pin1">Ver detalhes</a>'],['<h1>Coleta de entulho</h1><p>Enviada há 6 dias</p><a href="#/items/1" data-toggle="modal" data-target="#item_pin1">Ver detalhes</a>'],['<h1>Coleta de entulho</h1><p>Enviada há 2 dias</p><a href="#/items/1" data-toggle="modal" data-target="#item_pin1">Ver detalhes</a>']],[['<h1>Coleta de entulho</h1><p>Enviada hoje</p><a href="#/items/1" data-toggle="modal" data-target="#item_pin1">Ver detalhes</a>'],['<h1>Coleta de entulho</h1><p>Enviada ontem</p><a href="#/items/1" data-toggle="modal" data-target="#item_pin1">Ver detalhes</a>'],['<h1>Coleta de entulho</h1><p>Enviada há 2 dias</p><a href="#/items/1" data-toggle="modal" data-target="#item_pin1">Ver detalhes</a>'],['<h1>Coleta de entulho</h1><p>Enviada há 3 dias</p><a href="#/items/1" data-toggle="modal" data-target="#item_pin1">Ver detalhes</a>'],['<h1>Coleta de entulho</h1><p>Enviada há 4 dias</p><a href="#/items/1" data-toggle="modal" data-target="#item_pin1">Ver detalhes</a>'],['<h1>Coleta de entulho</h1><p>Enviada há 5 dias</p><a href="#/items/1" data-toggle="modal" data-target="#item_pin1">Ver detalhes</a>']],[['<h1>Coleta de entulho</h1><p>Enviada há 1 semana</p><a href="#/items/1" data-toggle="modal" data-target="#item_pin1">Ver detalhes</a>']]],l=j[0].length-1;l>=0;l--){var m=new google.maps.LatLng(j[0][l][0],j[0][l][1]),n=new google.maps.Marker({position:m,map:g,icon:i[0],animation:google.maps.Animation.DROP});h[0].push(n);var o=new google.maps.InfoWindow,p=l;google.maps.event.addListener(n,"click",function(){console.log(p),o.setContent('<div class="pinTooltip">'+k[0][p]+"</div>"),o.open(g,this)})}for(var l=j[1].length-1;l>=0;l--){var m=new google.maps.LatLng(j[1][l][0],j[1][l][1]),n=new google.maps.Marker({position:m,map:g,icon:i[1],animation:google.maps.Animation.DROP});h[1].push(n);var o=new google.maps.InfoWindow,p=l;google.maps.event.addListener(n,"click",function(){o.setContent('<div class="pinTooltip">'+k[1][p]+"</div>"),o.open(g,this)})}for(var l=j[2].length-1;l>=0;l--){var m=new google.maps.LatLng(j[2][l][0],j[2][l][1]),n=new google.maps.Marker({position:m,map:g,icon:i[2],animation:google.maps.Animation.DROP});h[2].push(n);var o=new google.maps.InfoWindow,p=l;google.maps.event.addListener(n,"click",function(){o.setContent('<div class="pinTooltip">'+k[2][p]+"</div>"),o.open(g,this)})}for(var l=j[3].length-1;l>=0;l--){var m=new google.maps.LatLng(j[3][l][0],j[3][l][1]),n=new google.maps.Marker({position:m,map:g,icon:i[3],animation:google.maps.Animation.DROP});h[3].push(n);var o=new google.maps.InfoWindow,p=l;google.maps.event.addListener(n,"click",function(){o.setContent('<div class="pinTooltip">'+k[3][p]+"</div>"),o.open(g,this)})}for(var l=j[4].length-1;l>=0;l--){var m=new google.maps.LatLng(j[4][l][0],j[4][l][1]),n=new google.maps.Marker({position:m,map:g,icon:i[4],animation:google.maps.Animation.DROP});h[4].push(n);var o=new google.maps.InfoWindow,p=l;google.maps.event.addListener(n,"click",function(){o.setContent('<div class="pinTooltip">'+k[4][p]+"</div>"),o.open(g,this)})}$(window).resize(function(){b.css({width:$(window).width()-300,height:$(window).height()})})}}}),angular.module("zupWebAngularApp").factory("Alert",["$modal",function(a){return{show:function(b,c){a.open({templateUrl:"views/modal_alert.html",windowClass:"modal_alert",resolve:{text:function(){return{title:b,message:c}}},controller:["$scope","$modalInstance","text",function(a,b,c){a.title=c.title,a.message=c.message,a.close=function(){b.close()}}]})}}}]),angular.module("zupWebAngularApp").factory("Reports",["$resource",function(a){return a("{base_url}/reports/categories/:id.json",{id:"@id"},{getItemsByCategory:{url:"{base_url}/reports/:categoryId/items.json",method:"GET",params:{categoryId:"@categoryId"}},getItems:{url:"{base_url}/reports/items/:id.json",method:"GET",params:{id:"@id"}},save:{url:"{base_url}/reports/:categoryId/items.json",method:"POST",params:{categoryId:"@categoryId"}}})}]),angular.module("zupWebAngularApp").directive("reportCategoryIcon",function(){return{restrict:"A",link:function(a,b){b.click(function(){angular.element(".report_filter").removeClass("active"),b.addClass("active")})}}}),angular.module("zupWebAngularApp").directive("reportMap",function(){return{restrict:"A",link:function(a,b){var c=[{},{featureType:"poi.business",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.government",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.medical",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.place_of_worship",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.school",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.sports_complex",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"labels",stylers:[{visibility:"off"},{saturation:-100},{lightness:42}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{saturation:-100},{lightness:47}]},{featureType:"landscape",stylers:[{lightness:82},{saturation:-100}]},{featureType:"water",stylers:[{hue:"#00b2ff"},{saturation:-21},{lightness:-4}]},{featureType:"poi",stylers:[{lightness:19},{weight:.1},{saturation:-22}]},{elementType:"geometry.fill",stylers:[{visibility:"on"},{lightness:18}]},{elementType:"labels.text",stylers:[{saturation:-100},{lightness:28}]},{featureType:"poi.attraction",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{saturation:12},{lightness:25}]},{featureType:"road",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels.text",stylers:[{lightness:30}]},{featureType:"landscape.man_made",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{saturation:-100},{lightness:56}]},{featureType:"road.local",elementType:"geometry.fill",stylers:[{lightness:62}]},{featureType:"landscape.man_made",elementType:"geometry",stylers:[{visibility:"off"}]}],d=new google.maps.StyledMapType(c,{name:"zup"}),e=new google.maps.LatLng(-23.549671,-46.6321713),f={center:e,zoom:17,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,"zup"]}},g=new google.maps.Map(b[0],f),h=new google.maps.Marker({map:g,draggable:!0,animation:google.maps.Animation.DROP,position:e});g.mapTypes.set("zup",d),g.setMapTypeId("zup"),google.maps.event.addListener(h,"dragend",function(){var b=new google.maps.Geocoder;a.$parent.lat=h.getPosition().lat(),a.$parent.lng=h.getPosition().lng(),b.geocode({latLng:h.getPosition()},function(b,c){c===google.maps.GeocoderStatus.OK?a.$parent.formattedAddress=b[0].formatted_address:console.log("Cannot determine address at this location."+c)})}),a.$watch("categoryData",function(){setTimeout(function(){google.maps.event.trigger(g,"resize"),google.maps.event.trigger(g,"bounds_changed"),g.setCenter(h.getPosition()),null!==a.$parent.categoryData&&h.setIcon(a.$parent.categoryData.marker.url),a.$parent.lat=null,a.$parent.lng=null,a.$parent.formattedAddress=null},80)})}}}),angular.module("zupWebAngularApp").directive("mainMap",["Reports","$rootScope","$compile",function(a,b,c){return{restrict:"A",link:function(d,e){var f=[{},{featureType:"poi.business",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.government",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.medical",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.place_of_worship",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.school",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.sports_complex",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"labels",stylers:[{visibility:"off"},{saturation:-100},{lightness:42}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{saturation:-100},{lightness:47}]},{featureType:"landscape",stylers:[{lightness:82},{saturation:-100}]},{featureType:"water",stylers:[{hue:"#00b2ff"},{saturation:-21},{lightness:-4}]},{featureType:"poi",stylers:[{lightness:19},{weight:.1},{saturation:-22}]},{elementType:"geometry.fill",stylers:[{visibility:"on"},{lightness:18}]},{elementType:"labels.text",stylers:[{saturation:-100},{lightness:28}]},{featureType:"poi.attraction",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{saturation:12},{lightness:25}]},{featureType:"road",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels.text",stylers:[{lightness:30}]},{featureType:"landscape.man_made",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{saturation:-100},{lightness:56}]},{featureType:"road.local",elementType:"geometry.fill",stylers:[{lightness:62}]},{featureType:"landscape.man_made",elementType:"geometry",stylers:[{visibility:"off"}]}];e.css({width:$(window).width()-300,height:$(window).height()});var g=new google.maps.StyledMapType(f,{name:"zup"}),h=new google.maps.LatLng(-23.549671,-46.6321713),i={center:h,zoom:15,disableDefaultUI:!0,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,"zup"]}},j=new google.maps.Map(e[0],i);j.mapTypes.set("zup",g),j.setMapTypeId("zup"),$(window).resize(function(){e.css({width:$(window).width()-300,height:$(window).height()})}),google.maps.event.addListener(j,"center_changed",function(){}),d.$watch("isLoading",function(){if(d.isLoading===!1){var e={"position[latitude]":-23.549671,"position[longitude]":-46.6321713,"position[distance]":1e5,max_items:40};a.getItems(e,function(a){for(var e=a.reports.length-1;e>=0;e--){var f=new google.maps.LatLng(a.reports[e].position.latitude,a.reports[e].position.longitude),g=new google.maps.InfoWindow,h=b.getReportCategory(a.reports[e].category_id),i=new google.maps.Marker({position:f,map:j,animation:google.maps.Animation.DROP,icon:h.marker.url,category:h,report:a.reports[e]});b.markers.reports[h.id].push(i),google.maps.event.addListener(i,"click",function(){var a='<div class="pinTooltip"><h1>{{category.title}}</h1><p>Enviada {{ report.created_at | date: \'dd/MM/yy HH:mm\'}}</p><a href="" ng-click="viewReport(report, category)">Ver detalhes</a></div>',e=d.$new(!0);e.category=this.category,e.report=this.report,e.viewReport=b.viewReport;var f=c(a)(e);e.$apply(),g.setContent(f[0]),g.open(j,this)})}console.log(b.markers)})}})}}}]),angular.module("zupWebAngularApp").directive("filterReportsCategory",function(){return{restrict:"A",link:function(a,b){b.click(function(){b.toggleClass("active")})}}}),angular.module("zupWebAngularApp").controller("ReportsCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("zupWebAngularApp").controller("AccountCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("zupWebAngularApp").directive("changeBodyStyle",function(){return{restrict:"A",link:function(a,b){a.$watch("page",function(){"reports"===a.page||"account"===a.page?b.addClass("account"):b.removeClass("account")})}}});