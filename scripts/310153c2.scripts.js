"use strict";angular.module("zupWebAngularApp",["ngCookies","ngResource","ngSanitize","ngRoute","ui.bootstrap"]).config(["$routeProvider","$httpProvider",function(a,b){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"}),b.interceptors.push(["$q","$injector",function(a,b){return{request:function(c){c.url=c.url.replace("{base_url}","http://staging.zup.sapience.io");var d=null;return b.invoke(["Auth",function(a){d=a.getToken()}]),c.headers["X-App-Token"]=d,c||a.when(c)},responseError:function(c){var d=c.config.expectedErrors;return("undefined"==typeof d||-1===d.indexOf(c.status))&&b.invoke(["Error",function(a){a.showDetails(c)}]),a.reject(c)}}}]),b.defaults.useXDomain=!0,delete b.defaults.headers.common["X-Requested-With"]}]).run(["$rootScope","$location","Auth","$modal",function(a,b,c,d){a.$on("$routeChangeStart",function(b,d,e){"undefined"==typeof e&&(a.isLoading=!0);var f=c.check();f.then(function(){a.isLoading=!1,a.logged=!0},function(){a.isLoading=!1,a.false=!0})}),a.login=function(){d.open({templateUrl:"views/modal_login.html",windowClass:"modal_login",controller:["$scope","$modalInstance","User",function(b,c,d){b.input={},b.close=function(){c.close()},b.login=function(){b.loginError=!1;var e=new d(b.input.email,b.input.password);e.auth().then(function(){a.logged=!0,c.close()},function(a){(400===a.status||401===a.status)&&(b.loginError=!0)})}}]})},a.logout=function(){c.clearToken(),c.saveUser(null),a.logged=!1}}]),angular.module("zupWebAngularApp").controller("MainCtrl",function(){}),angular.module("zupWebAngularApp").service("User",["$q","$http","Auth",function(a,b,c){return function(d,e){this.auth=function(){var f=a.defer(),g=b({method:"POST",url:"{base_url}/authenticate.json",data:{email:d,password:e},expectedErrors:[400,401]});return g.success(function(a){c.saveUser(a.user),c.saveToken(a.token),f.resolve()}),g.error(function(a,b,c,d){f.reject({data:a,status:b,config:d})}),f.promise}}}]),angular.module("zupWebAngularApp").factory("Auth",["$q","$http","$cookies","$rootScope",function(a,b,c,d){var e=null;return{check:function(){var c=a.defer(),d=this.getToken();if(null!==d&&null===e){var f=b({method:"GET",url:"{base_url}/me.json",headers:{"X-App-Token":d}}),g=this;f.success(function(a){g.saveUser(a.user),c.resolve()}),f.error(function(){c.reject(),g.clearToken()})}else null!==d&&null!==e?c.resolve():(c.reject(),this.clearToken());return c.promise},getToken:function(){var a=c.token;return"undefined"==typeof a?null:a},saveToken:function(a){c.token=a},clearToken:function(){delete c.token},saveUser:function(a){e=a,d.me=e},isLogged:function(){return null!==e&&null!==this.getToken()}}}]);